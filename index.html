<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emerg√™ncia Hospital</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:12px 12px 60px}
.container{max-width:500px;margin:0 auto}
.emergency-buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;position:sticky;top:0;z-index:100;background:rgba(255,255,255,0.98);padding:12px;border-radius:12px;box-shadow:0 6px 25px rgba(0,0,0,0.3)}
.emergency-btn{background:#dc2626;color:white;border:none;padding:15px;border-radius:10px;font-size:20px;font-weight:bold;cursor:pointer;box-shadow:0 4px 12px rgba(220,38,38,0.4);transition:all 0.2s;text-decoration:none;display:flex;flex-direction:column;align-items:center;gap:4px}
.emergency-btn:active{transform:scale(0.95)}
.emergency-number{font-size:28px;font-weight:900}
.emergency-label{font-size:13px;font-weight:normal}
.toggle-container{background:white;padding:12px;border-radius:12px;margin-bottom:15px;box-shadow:0 3px 12px rgba(0,0,0,0.1)}
.toggle-wrapper{display:flex;gap:8px;background:#f3f4f6;border-radius:8px;padding:4px}
.toggle-btn{flex:1;padding:10px;border:none;background:transparent;border-radius:6px;font-size:15px;font-weight:bold;cursor:pointer;transition:all 0.3s;color:#6b7280}
.toggle-btn.active{background:white;color:#667eea;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.place-card{background:white;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 3px 12px rgba(0,0,0,0.08)}
.place-name{font-size:18px;font-weight:bold;color:#1f2937;margin-bottom:6px;line-height:1.3}
.place-info{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
.info-item{display:flex;align-items:center;gap:6px;font-size:15px;color:#6b7280}
.distance{background:#dbeafe;color:#1e40af;padding:3px 8px;border-radius:15px;font-size:14px;font-weight:bold;display:inline-block}
.action-buttons{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.action-btn{padding:10px;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:5px;text-decoration:none}
.uber-btn{background:#000000;color:white}
.whatsapp-btn{background:#25D366;color:white}
.call-btn{background:#1f2937;color:#fff}
.action-btn:active{transform:scale(0.95)}
.loading{text-align:center;padding:30px;color:white;font-size:18px;background:rgba(255,255,255,0.1);border-radius:12px;margin:10px 0}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal.show{display:flex}
.modal-content{background:white;padding:25px;border-radius:15px;max-width:380px;width:100%}
.modal-title{font-size:22px;font-weight:bold;margin-bottom:8px;color:#1f2937}
.modal-subtitle{font-size:15px;color:#6b7280;margin-bottom:20px}
.form-group{margin-bottom:15px}
.form-label{display:block;font-size:17px;font-weight:bold;margin-bottom:6px;color:#374151}
.form-input{width:100%;padding:13px;border:2px solid #e5e7eb;border-radius:8px;font-size:17px}
.form-input:focus{outline:none;border-color:#667eea}
.modal-btn{width:100%;padding:15px;border:none;border-radius:8px;font-size:18px;font-weight:bold;cursor:pointer;background:#667eea;color:white}
.hidden{display:none}
.location-prompt{background:white;padding:20px;border-radius:12px;margin-bottom:15px;box-shadow:0 3px 12px rgba(0,0,0,0.1);text-align:center}
.location-prompt h3{font-size:20px;color:#1f2937;margin-bottom:10px}
.location-prompt p{font-size:16px;color:#6b7280;line-height:1.5}
.footer-pad{height:24px}
</style>
</head>
<body>
<div class="container">
  <div class="emergency-buttons">
    <a href="tel:192" class="emergency-btn"><span class="emergency-number">192</span><span class="emergency-label">SAMU</span></a>
    <a href="tel:193" class="emergency-btn"><span class="emergency-number">193</span><span class="emergency-label">BOMBEIROS</span></a>
  </div>

  <div class="toggle-container">
    <div class="toggle-wrapper">
      <button id="btnHosp" class="toggle-btn active" onclick="showHospitals()">üè• HOSPITAIS</button>
      <button id="btnLabs" class="toggle-btn" onclick="showLabs()">üî¨ EXAMES</button>
    </div>
  </div>

  <div id="location-prompt" class="location-prompt">
    <h3>üìç Precisamos da sua localiza√ß√£o</h3>
    <p>Vamos mostrar os locais mais pr√≥ximos. A localiza√ß√£o √© usada apenas agora.</p>
  </div>

  <div id="loading" class="loading hidden">üìç Buscando locais pr√≥ximos...</div>

  <div id="hospitals-list"></div>
  <div id="labs-list" class="hidden"></div>
  <div class="footer-pad"></div>
</div>

<!-- Modal contato -->
<div id="contact-modal" class="modal" onclick="closeModal(event)">
  <div class="modal-content">
    <div class="modal-title">üë§ Contato de Emerg√™ncia</div>
    <div class="modal-subtitle">Ser√° avisado por WhatsApp</div>
    <div class="form-group">
      <label class="form-label">Nome:</label>
      <input type="text" id="contact-name" class="form-input" placeholder="Digite o nome">
    </div>
    <div class="form-group">
      <label class="form-label">Telefone (DDD + n√∫mero):</label>
      <input type="tel" id="contact-phone" class="form-input" placeholder="11999999999">
    </div>
    <button class="modal-btn" onclick="saveContact()">SALVAR</button>
  </div>
</div>

<script>
/* ====== DADOS (mantive sua lista original) ====== */
const hospitals=[
  {name:"Hospital Vit√≥ria",address:"Vila Regente Feij√≥",phone:"(11) 3581-1000",lat:-23.555,lng:-46.619},
  {name:"Hospital Sancta Maggiore Para√≠so",address:"Para√≠so",phone:"(11) 3474-1100",lat:-23.576,lng:-46.643},
  {name:"Hospital S√£o Camilo Pompeia",address:"Pompeia",phone:"(11) 3677-3000",lat:-23.528,lng:-46.681},
  {name:"Hospital Nove de Julho",address:"Bela Vista",phone:"(11) 3147-9000",lat:-23.557,lng:-46.649},
  {name:"Hospital Villa Lobos",address:"Alto de Pinheiros",phone:"(11) 2146-8000",lat:-23.546,lng:-46.707},
  {name:"Hospital S√£o Luiz Itaim",address:"Itaim Bibi",phone:"(11) 3040-0300",lat:-23.589,lng:-46.679},
  {name:"Hospital Albert Einstein Morumbi",address:"Morumbi",phone:"(11) 2151-1233",lat:-23.598,lng:-46.713},
  {name:"Hospital S√≠rio-Liban√™s",address:"Bela Vista",phone:"(11) 3155-1000",lat:-23.555,lng:-46.655},
  {name:"Hospital Santa Catarina",address:"Paulista",phone:"(11) 3016-0000",lat:-23.560,lng:-46.659},
  {name:"Hospital Alem√£o Oswaldo Cruz",address:"Para√≠so",phone:"(11) 3549-0000",lat:-23.573,lng:-46.644},
  {name:"BP Hospital Benefic√™ncia Portuguesa",address:"Bela Vista",phone:"(11) 3505-1000",lat:-23.558,lng:-46.644},
  {name:"Hospital Santa Cruz",address:"Vila Mariana",phone:"(11) 5080-5500",lat:-23.582,lng:-46.635},
  {name:"Hospital Samaritano Higien√≥polis",address:"Higien√≥polis",phone:"(11) 3821-5300",lat:-23.543,lng:-46.654},
  {name:"Hospital Samaritano Paulista",address:"Bela Vista",phone:"(11) 3821-5300",lat:-23.560,lng:-46.653},
  {name:"Hospital S√£o Camilo Santana",address:"Santana",phone:"(11) 2021-5000",lat:-23.504,lng:-46.626},
  {name:"Hospital S√£o Luiz Morumbi",address:"Morumbi",phone:"(11) 3040-0300",lat:-23.614,lng:-46.700},
  {name:"Hospital S√£o Paulo",address:"Vila Clementino",phone:"(11) 5576-4000",lat:-23.598,lng:-46.645},
  {name:"Hospital Edmundo Vasconcelos",address:"Vila Mariana",phone:"(11) 5080-4000",lat:-23.594,lng:-46.636},
  {name:"Hospital Santa Paula",address:"√Ågua Funda",phone:"(11) 3040-8800",lat:-23.623,lng:-46.632},
  {name:"Hospital Santa Isabel",address:"Vila Isabel",phone:"(11) 2137-6000",lat:-23.577,lng:-46.627},
  {name:"Hospital Leforte Morumbi",address:"Morumbi",phone:"(11) 3345-2000",lat:-23.608,lng:-46.708},
  {name:"Hospital e Maternidade Santa Joana",address:"Para√≠so",phone:"(11) 5080-6000",lat:-23.574,lng:-46.640},
  {name:"Hospital Sepaco",address:"√Ågua Branca",phone:"(11) 3876-8500",lat:-23.521,lng:-46.683},
  {name:"CEJAM UPA Consola√ß√£o",address:"Consola√ß√£o",phone:"(11) 3125-5000",lat:-23.549,lng:-46.656},
  {name:"Hospital Igesp",address:"Vila Mariana",phone:"(11) 5549-2000",lat:-23.582,lng:-46.636},
  {name:"Hospital Vital Brazil",address:"Butant√£",phone:"(11) 3723-9000",lat:-23.577,lng:-46.718}
];

const labs=[
  {name:"Femme Lab - Mooca",address:"Mooca",phone:"(11) 3050-9043",bookingPhone:"(11) 3050-9043",lat:-23.550,lng:-46.5928},
  {name:"Femme Lab - Barra Funda",address:"Barra Funda",phone:"(11) 3392-7000",bookingPhone:"(11) 3392-7000",lat:-23.528,lng:-46.667},
  {name:"Femme Lab - Tatuap√©",address:"Tatuap√©",phone:"(11) 2091-4040",bookingPhone:"(11) 2091-4040",lat:-23.535,lng:-46.576},
  {name:"Femme Lab - Pinheiros",address:"Pinheiros",phone:"(11) 3813-8181",bookingPhone:"(11) 3813-8181",lat:-23.567,lng:-46.688},
  {name:"Femme Lab - Santana",address:"Santana",phone:"(11) 2977-9797",bookingPhone:"(11) 2977-9797",lat:-23.508,lng:-46.630},
  {name:"Femme Lab - Santo Amaro",address:"Santo Amaro",phone:"(11) 5686-6060",bookingPhone:"(11) 5686-6060",lat:-23.652,lng:-46.705},
  {name:"Femme Lab - Penha",address:"Penha",phone:"(11) 2741-4141",bookingPhone:"(11) 2741-4141",lat:-23.530,lng:-46.543}
];

/* ====== VARS ====== */
let userLat=null,userLng=null;
let currentView='hospitals';

/* ====== UTILS ====== */
function haversine(lat1,lng1,lat2,lng2){
  const R=6371; // km
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLng=(lng2-lng1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
function onlyDigits(s){ return (s||'').replace(/\D/g,''); }

/* ====== RENDER ====== */
function renderPlaces(places,containerId){
  const container=document.getElementById(containerId);
  container.innerHTML='';
  places.forEach(place=>{
    const card=document.createElement('div');
    card.className='place-card';
    const placeJson=JSON.stringify(place).replace(/"/g,'&quot;');

    const booking = place.bookingPhone || place.phone;
    const bookingDigits = onlyDigits(booking);

    const isLab = containerId==='labs-list';
    // Bot√µes: labs t√™m 3 (Uber, Avisar, Ligar p/ Agendar); hospitais mant√™m 2 (Uber, Avisar)
    const actions = `
      <button class="action-btn uber-btn" onclick='requestUber(${placeJson})'>üöó UBER</button>
      <button class="action-btn whatsapp-btn" onclick='notifyContact(${placeJson})'>üí¨ AVISAR</button>
      ${isLab ? `<a class="action-btn call-btn" href="tel:${bookingDigits}">üìû LIGAR P/ AGENDAR</a>` : ``}
    `;

    card.innerHTML=`
      <div class="place-name">${place.name}</div>
      <div class="place-info">
        <div class="info-item">üìç ${place.address}</div>
        <div class="info-item">üìû ${place.phone}</div>
        ${isLab ? `<div class="info-item">üóìÔ∏è Agendamento: ${booking}</div>` : ``}
        ${place.distance!=null?`<div class="info-item"><span class="distance">${place.distance.toFixed(1)} km</span></div>`:''}
      </div>
      <div class="action-buttons">
        ${actions}
      </div>
    `;
    container.appendChild(card);
  });
}

/* ====== TOGGLES ====== */
function showHospitals(){
  currentView='hospitals';
  document.getElementById('btnHosp').classList.add('active');
  document.getElementById('btnLabs').classList.remove('active');
  document.getElementById('hospitals-list').classList.remove('hidden');
  document.getElementById('labs-list').classList.add('hidden');
  computeAndRender();
}
function showLabs(){
  currentView='labs';
  document.getElementById('btnLabs').classList.add('active');
  document.getElementById('btnHosp').classList.remove('active');
  document.getElementById('labs-list').classList.remove('hidden');
  document.getElementById('hospitals-list').classList.add('hidden');
  computeAndRender();
}

/* ====== CONTATO (localStorage) ====== */
function openContactModal(){
  const modal=document.getElementById('contact-modal');
  const saved=JSON.parse(localStorage.getItem('emg_contact')||'{}');
  document.getElementById('contact-name').value=saved.name||'';
  document.getElementById('contact-phone').value=saved.phone||'';
  modal.classList.add('show');
}
function closeModal(e){
  if(e.target && e.target.classList && e.target.classList.contains('modal')){
    e.target.classList.remove('show');
  }
}
function saveContact(){
  const name=document.getElementById('contact-name').value.trim();
  const phone=document.getElementById('contact-phone').value.trim();
  if(!name || !phone){ alert('Preencha nome e telefone.'); return; }
  localStorage.setItem('emg_contact', JSON.stringify({name,phone}));
  document.getElementById('contact-modal').classList.remove('show');
  alert('Contato salvo.');
}

/* ====== A√á√ïES ====== */
function requestUber(place){
  const addr = `${place.name}, ${place.address}`;
  const url = `https://m.uber.com/ul/?action=setPickup&dropoff[formatted_address]=${encodeURIComponent(addr)}&dropoff[latitude]=${place.lat}&dropoff[longitude]=${place.lng}`;
  window.open(url, '_blank');
}
function notifyContact(place){
  const saved=JSON.parse(localStorage.getItem('emg_contact')||'{}');
  if(!saved.phone){ openContactModal(); return; }
  const phone = onlyDigits(saved.phone);
  const msg = `Estou pedindo um Uber para: ${place.name} (${place.address}).`;
  const url = `https://wa.me/55${phone}?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
}

/* ====== GEO E LISTAGEM ====== */
function setLoading(v){ document.getElementById('loading').classList.toggle('hidden', !v); }

function computeAndRender(){
  let base = (currentView==='hospitals'? [...hospitals]: [...labs]);

  // calcula dist√¢ncias se tiver localiza√ß√£o
  if(userLat!=null && userLng!=null){
    base = base.map(p => ({...p, distance: haversine(userLat,userLng,p.lat,p.lng)}))
               .sort((a,b)=>(a.distance??1e9)-(b.distance??1e9));
  }

  // regra de "pelo menos 5" para LABS
  if(currentView==='labs'){
    base = base.slice(0, Math.min(5, base.length)); // mostra no m√°ximo 5 (os mais pr√≥ximos)
    // Se preferir mostrar todos, mas garantir que os 5 primeiros est√£o sempre vis√≠veis,
    // remova a linha acima.
  }

  renderPlaces(base, currentView==='hospitals' ? 'hospitals-list' : 'labs-list');
}

function askLocation(){
  const promptDiv=document.getElementById('location-prompt');
  setLoading(true);
  if(!navigator.geolocation){
    setLoading(false);
    promptDiv.innerHTML = "<h3>‚ö†Ô∏è Sem geolocaliza√ß√£o</h3><p>Mostrando lista sem dist√¢ncia.</p>";
    computeAndRender();
    return;
  }
  navigator.geolocation.getCurrentPosition(
    (pos)=>{
      userLat = pos.coords.latitude;
      userLng = pos.coords.longitude;
      document.getElementById('location-prompt').classList.add('hidden');
      setLoading(false);
      computeAndRender();
    },
    (err)=>{
      setLoading(false);
      promptDiv.innerHTML = "<h3>‚ö†Ô∏è N√£o foi poss√≠vel obter a localiza√ß√£o</h3><p>Permita o acesso ou tente novamente. Exibindo sem dist√¢ncia.</p>";
      computeAndRender();
    },
    { enableHighAccuracy:true, timeout:10000, maximumAge:5000 }
  );
}

/* ====== STARTUP ====== */
document.addEventListener('DOMContentLoaded', ()=>{
  computeAndRender();   // render inicial
  askLocation();        // tenta localizar
});
</script>
</body>
</html>
