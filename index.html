<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emerg√™ncia Hospital</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:12px 12px 60px}
.container{max-width:500px;margin:0 auto}
.emergency-buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;position:sticky;top:0;z-index:100;background:rgba(255,255,255,0.98);padding:12px;border-radius:12px;box-shadow:0 6px 25px rgba(0,0,0,0.3)}
.emergency-btn{background:#dc2626;color:white;border:none;padding:15px;border-radius:10px;font-size:20px;font-weight:bold;cursor:pointer;box-shadow:0 4px 12px rgba(220,38,38,0.4);transition:all 0.2s;text-decoration:none;display:flex;flex-direction:column;align-items:center;gap:4px}
.emergency-btn:active{transform:scale(0.95)}
.emergency-number{font-size:28px;font-weight:900}
.emergency-label{font-size:13px;font-weight:normal}
.toggle-container{background:white;padding:12px;border-radius:12px;margin-bottom:15px;box-shadow:0 3px 12px rgba(0,0,0,0.1)}
.toggle-wrapper{display:flex;gap:8px;background:#f3f4f6;border-radius:8px;padding:4px}
.toggle-btn{flex:1;padding:10px;border:none;background:transparent;border-radius:6px;font-size:15px;font-weight:bold;cursor:pointer;transition:all 0.3s;color:#6b7280}
.toggle-btn.active{background:white;color:#667eea;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.place-card{background:white;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 3px 12px rgba(0,0,0,0.08)}
.place-name{font-size:18px;font-weight:bold;color:#1f2937;margin-bottom:6px;line-height:1.3}
.place-info{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
.info-item{display:flex;align-items:center;gap:6px;font-size:15px;color:#6b7280}
.distance{background:#dbeafe;color:#1e40af;padding:3px 8px;border-radius:15px;font-size:14px;font-weight:bold;display:inline-block}
.action-buttons{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.action-btn{padding:10px;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:5px;text-decoration:none}
.uber-btn{background:#000000;color:white}
.whatsapp-btn{background:#25D366;color:white}
.action-btn:active{transform:scale(0.95)}
.loading{text-align:center;padding:30px;color:white;font-size:18px;background:rgba(255,255,255,0.1);border-radius:12px;margin:10px 0}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal.show{display:flex}
.modal-content{background:white;padding:25px;border-radius:15px;max-width:380px;width:100%}
.modal-title{font-size:22px;font-weight:bold;margin-bottom:8px;color:#1f2937}
.modal-subtitle{font-size:15px;color:#6b7280;margin-bottom:20px}
.form-group{margin-bottom:15px}
.form-label{display:block;font-size:17px;font-weight:bold;margin-bottom:6px;color:#374151}
.form-input{width:100%;padding:13px;border:2px solid #e5e7eb;border-radius:8px;font-size:17px}
.form-input:focus{outline:none;border-color:#667eea}
.modal-btn{width:100%;padding:15px;border:none;border-radius:8px;font-size:18px;font-weight:bold;cursor:pointer;background:#667eea;color:white}
.hidden{display:none}
.location-prompt{background:white;padding:20px;border-radius:12px;margin-bottom:15px;box-shadow:0 3px 12px rgba(0,0,0,0.1);text-align:center}
.location-prompt h3{font-size:20px;color:#1f2937;margin-bottom:10px}
.location-prompt p{font-size:16px;color:#6b7280;line-height:1.5}
.footer-pad{height:24px}
</style>
</head>
<body>
<div class="container">
  <div class="emergency-buttons">
    <a href="tel:192" class="emergency-btn"><span class="emergency-number">192</span><span class="emergency-label">SAMU</span></a>
    <a href="tel:193" class="emergency-btn"><span class="emergency-number">193</span><span class="emergency-label">BOMBEIROS</span></a>
  </div>

  <div class="toggle-container">
    <div class="toggle-wrapper">
      <button id="btnHosp" class="toggle-btn active" onclick="showHospitals()">üè• HOSPITAIS</button>
      <button id="btnLabs" class="toggle-btn" onclick="showLabs()">üî¨ EXAMES</button>
    </div>
  </div>

  <div id="location-prompt" class="location-prompt">
    <h3>üìç Precisamos da sua localiza√ß√£o</h3>
    <p>Vamos mostrar os hospitais mais pr√≥ximos de voc√™. A localiza√ß√£o √© usada apenas agora.</p>
  </div>

  <div id="loading" class="loading hidden">üìç Buscando locais pr√≥ximos...</div>

  <div id="hospitals-list"></div>
  <div id="labs-list" class="hidden"></div>
  <div class="footer-pad"></div>
</div>

<!-- Modal contato -->
<div id="contact-modal" class="modal" onclick="closeModal(event)">
  <div class="modal-content">
    <div class="modal-title">üë§ Contato de Emerg√™ncia</div>
    <div class="modal-subtitle">Ser√° avisado por WhatsApp</div>
    <div class="form-group">
      <label class="form-label">Nome:</label>
      <input type="text" id="contact-name" class="form-input" placeholder="Digite o nome">
    </div>
    <div class="form-group">
      <label class="form-label">Telefone (DDD + n√∫mero):</label>
      <input type="tel" id="contact-phone" class="form-input" placeholder="11999999999">
    </div>
    <button class="modal-btn" onclick="saveContact()">SALVAR</button>
  </div>
</div>

<script>
const hospitals=[
  {name:"Hospital Vit√≥ria",address:"Vila Regente Feij√≥",phone:"(11) 3581-1000",lat:-23.555,lng:-46.619},
  {name:"Hospital Sancta Maggiore Para√≠so",address:"Para√≠so",phone:"(11) 3474-1100",lat:-23.576,lng:-46.643},
  {name:"Hospital S√£o Camilo Pompeia",address:"Pompeia",phone:"(11) 3677-3000",lat:-23.528,lng:-46.681}
];

const labs=[
  {name:"Femme Lab - Mooca",address:"Mooca",phone:"(11) 3050-9043",lat:-23.550,lng:-46.5928},
  {name:"Femme Lab - Tatuap√©",address:"Tatuap√©",phone:"(11) 2091-4040",lat:-23.535,lng:-46.576}
];

let userLat=null,userLng=null;
let currentView='hospitals';

function haversine(lat1,lng1,lat2,lng2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLng=(lng2-lng1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function renderPlaces(places,containerId){
  const container=document.getElementById(containerId);
  container.innerHTML='';
  places.forEach(p=>{
    const card=document.createElement('div');
    card.className='place-card';
    const json=JSON.stringify(p).replace(/"/g,'&quot;');
    card.innerHTML=`
      <div class="place-name">${p.name}</div>
      <div class="place-info">
        <div class="info-item">üìç ${p.address}</div>
        <div class="info-item">üìû ${p.phone}</div>
        ${p.distance?`<div class="info-item"><span class="distance">${p.distance.toFixed(1)} km</span></div>`:''}
      </div>
      <div class="action-buttons">
        <button class="action-btn uber-btn" onclick='requestUber(${json})'>üöó UBER</button>
        <button class="action-btn whatsapp-btn" onclick='notifyContact(${json})'>üí¨ AVISAR</button>
      </div>`;
    container.appendChild(card);
  });
}

function computeAndRender(){
  const base=currentView==='hospitals'?[...hospitals]:[...labs];
  if(userLat!=null){
    base.forEach(p=>p.distance=haversine(userLat,userLng,p.lat,p.lng));
    base.sort((a,b)=>a.distance-b.distance);
  }
  renderPlaces(base,currentView==='hospitals'?'hospitals-list':'labs-list');
}

function showHospitals(){
  currentView='hospitals';
  document.getElementById('btnHosp').classList.add('active');
  document.getElementById('btnLabs').classList.remove('active');
  document.getElementById('hospitals-list').classList.remove('hidden');
  document.getElementById('labs-list').classList.add('hidden');
  computeAndRender();
}

function showLabs(){
  currentView='labs';
  document.getElementById('btnLabs').classList.add('active');
  document.getElementById('btnHosp').classList.remove('active');
  document.getElementById('labs-list').classList.remove('hidden');
  document.getElementById('hospitals-list').classList.add('hidden');
  computeAndRender();
}

function requestUber(place){
  const addr=`${place.name}, ${place.address}`;
  const url=`https://m.uber.com/ul/?action=setPickup&dropoff[formatted_address]=${encodeURIComponent(addr)}&dropoff[latitude]=${place.lat}&dropoff[longitude]=${place.lng}`;
  window.open(url,'_blank');
}

function notifyContact(place){
  const saved=JSON.parse(localStorage.getItem('emg_contact')||'{}');
  if(!saved.phone){openContactModal();return;}
  const phone=(saved.phone||'').replace(/\D/g,'');
  const msg=`Estou pedindo um Uber para o hospital: ${place.name} (${place.address}).`;
  window.open(`https://wa.me/55${phone}?text=${encodeURIComponent(msg)}`,'_blank');
}

function openContactModal(){
  const m=document.getElementById('contact-modal');
  const s=JSON.parse(localStorage.getItem('emg_contact')||'{}');
  document.getElementById('contact-name').value=s.name||'';
  document.getElementById('contact-phone').value=s.phone||'';
  m.classList.add('show');
}
function closeModal(e){if(e.target.classList.contains('modal'))e.target.classList.remove('show');}
function saveContact(){
  const n=document.getElementById('contact-name').value.trim();
  const p=document.getElementById('contact-phone').value.trim();
  if(!n||!p){alert('Preencha nome e telefone');return;}
  localStorage.setItem('emg_contact',JSON.stringify({name:n,phone:p}));
  document.getElementById('contact-modal').classList.remove('show');
  alert('Contato salvo!');
}

function askLocation(){
  const prompt=document.getElementById('location-prompt');
  if(!navigator.geolocation){computeAndRender();return;}
  navigator.geolocation.getCurrentPosition(pos=>{
    userLat=pos.coords.latitude;
    userLng=pos.coords.longitude;
    prompt.classList.add('hidden');
    computeAndRender();
  },()=>{computeAndRender();});
}

document.addEventListener('DOMContentLoaded',()=>{
  computeAndRender();
  askLocation();
});
</script>
</body>
</html>
